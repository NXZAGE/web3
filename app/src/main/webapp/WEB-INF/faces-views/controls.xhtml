<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="jakarta.faces.html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:p="primefaces" xmlns:comp="jakarta.faces.composite/components">
<h:head>
  <title>Controls - LAB3</title>
  <script src="https://unpkg.com/konva@10/konva.min.js" />
  <h:outputStylesheet library="styles" name="css/controls.css" />
</h:head>


<h:body>
  <comp:header />

  <div class="content main-wrapper">
    <div class="main-panel-wrapper">

      <div class="control-container">
        <h:form id="main-form">
          <p:card styleClass="form-card">

            <f:facet name="title">
              <span class="form-title">Parameters</span>
            </f:facet>

            <!-- X -->
            <div class="form-row">
              <div class="form-label">
                <span>X</span>
              </div>
              <div class="form-field">
                <p:selectOneMenu id="x" value="#{hitFormBean.x}" styleClass="w-full">
                  <f:selectItems value="#{arrayUtils.range(-2, 2, 0.5)}" />
                </p:selectOneMenu>
              </div>
            </div>

            <!-- Y -->
            <div class="form-row">
              <div class="form-label">
                <span>Y</span>
              </div>
              <div class="form-field">
                <p:inputText id="y" value="#{hitFormBean.y}" styleClass="w-full">
                  <f:validateDoubleRange minimum="-3" maximum="5" />
                </p:inputText>
              </div>
            </div>

            <!-- R -->
            <div class="form-row">
              <div class="form-label">
                <span>R</span>
              </div>
              <div class="form-field slider-row">
                <p:inputNumber id="r" value="#{hitFormBean.r}" minValue="1" maxValue="4" step="0.25"
                  decimalPlaces="2" />

                <p:slider for="r" minValue="1" maxValue="4" step="0.25" onSlideEnd="handleRadiusMutation(ui.value)" />
              </div>
            </div>

            <!-- Submit -->
            <div class="actions">
              <div class="form-actions">
                <p:commandButton value="Submit" icon="pi pi-check" action="#{hitFormBean.submit}" process="@form"
                  update="hitDataTable growl" oncomplete="handleHitForm(xhr, status, args)" />
                <p:remoteCommand name="submitHit" actionListener="#{hitFormBean.remoteSubmit}" process="@this"
                  update="hitDataTable growl" oncomplete="handleHitForm(xhr, status, args)" />
                <p:remoteCommand name="getHits" actionListener="#{registry.getHitsRemote}" process="@this" update="@none"
                  oncomplete="handleGetHits(xhr, status, args)" />
              </div>

              <div class="page-actions">
                <p:button value="Go Home" icon="pi pi-home" outcome="home" />
              </div>
            </div>

          </p:card>

        </h:form>
      </div>
      <div class="canvas-container" id="canvas-container">
        <div id="canvas-object"></div>
      </div>
    </div>

    <div class="log-table-wrapper">
      <p:dataTable id="hitDataTable" value="#{registry.getHits()}" var="log" paginator="true" paginatorPosition="bottom"
        rows="5" lazy="false">
        <f:facet name="header">
          History
        </f:facet>

        <p:column headerText="X" width="14%">
          <h:outputText value="#{log.x}">
            <f:convertNumber maxFractionDigits="2" minFractionDigits="2" />
          </h:outputText>
        </p:column>
        <p:column headerText="Y" width="14%">
          <h:outputText value="#{log.y}">
            <f:convertNumber maxFractionDigits="2" minFractionDigits="2" />
          </h:outputText>
        </p:column>
        <p:column headerText="R" width="14%">
          <h:outputText value="#{log.r}">
            <f:convertNumber maxFractionDigits="2" minFractionDigits="2" />
          </h:outputText>
        </p:column>
        <p:column headerText="HIT" width="14%"> 
          #{log.hit ? "HIT" : "MISS"} 
        </p:column>
        <p:column headerText="EXECTIME" width="19%">
          <h:outputText value="#{log.exectime / 1000000 }">
            <f:convertNumber maxFractionDigits="3" minFractionDigits="3" />
          </h:outputText>
          <h:outputText value=" ms"/>
        </p:column>
        <p:column headerText="TIMESTAMP" width="25%" style="text-align: right;" > #{ datetime.formatTimestamp(log.timestamp) } </p:column>
      </p:dataTable>
    </div>
  </div>

  <p:growl id="growl" showDetail="true" sticky="false" life="3000" />
  <h:outputScript library="js" name="validation.js" />
  <h:outputScript library="js" name="hit_registry.js" />
  <h:outputScript library="js" name="formController.js" />
  <h:outputScript library="js" name="handler.js" />
  <h:outputScript library="js" name="canvas.js" />
</h:body>


</html>